### 🔶 트랜잭션

----

- 데이터베이스의 ' 상태를 변환 ' 시키는 하나의 논리적인 기능을 수행하기 위한 '논리적인 작업의 단위'
    + A 가 B에게 100만원을 이체 한다
        1. A의 계좌에서 잔액을 100만원 감소 - UPDATE
        2. B의 계좌에서 잔액을 100만원 증가 - UPDATE
        3. A의 최근 이체내역에 B에게 100만원 송금한 내용을 추가한다 - INSERT

    + 논리적인 작업의 단위 (그룹 묶음 연산들) = 감소 UPDATE + 증가 UPDATE + 추가 INSERT
    + 논리적인 작업의 단위를 구성하는 '모든 SQL 명령이' 성공적으로 완료되어야 한다
    + 그래야 하나의 작업 단위가 완료가 된것이고 , 이 때 데이터베이스에 반영한다.

<br>

---

<br>

#### 🔹 트랜잭션 관련 명령어

<br>

논리적인 작업 단위를 구성하는 모든 작업이 성공적으로 완료되었을 때 , <br>
데이터베이스의 트랜잭션 관리자에게
해당 작업 단위내에서 실행 했던 처리결과를 영구적으로 데이터베이스에 반영 시킨다.

```sql
COMMIT;
```

<br>

논리적인 작업 단위를 구성하는 작업 중에서 오류가 발생했을 때 , <br>
데이터베이스의 트랜잭션 관리자에게
해당 작업 단위내에서 실행 했던 처리결과의 데이터베이스의 반영을 취소 시킨다.

```sql
ROLLBACK;
```

<br>

----
<br>

#### 🔹 트랜잭션의 시작과 종료

#### ️1️⃣ 트랜잭션의 시작

- 첫번째 DML 명령문이 실행될 때 새로운 트랜잭션이 시작된다.
- COMMIT , ROLLBACK 명령을 실행하면 기존 트랜잭션이 종료되고 , 새로운 트랜잭션이 시작된다

<br>

#### 2️⃣ 트랜잭션의 종료

- COMMIT , ROLLBACK 명령을 실행하면 기존 트랜잭션이 종료된다
- DBMS에 시스템 장애가 발생할 때 AUTO ROLLBACK 이 실행되면서 트랜잭션이 종료된다

<br>

```sql
------------------------------------------------------------------트랜잭션 1이 시작됨
UPDATE ACCOUNTS
SET DEPOSIT = DEPOSIT - 100000
WHERE
    NO = 10; -- 트랙잭션 1의 연산이다.


UPDATE ACCOUNTS
SET DEPOSIT = DEPOSIT + 100000
WHERE
    NO = 20; -- 트랙잭션 1의 연산이다.


INSERT INTO HISTROIES
VALUES (10, 20, 100000, SYSDATE); -- 트랙잭션 1의 연산이다.

COMMIT;
-- 트랜잭션1의 모든 연산이 오류없이 실행되었기 때문에
-- 트랜잭션 관리자에게 트랜잭션1의 처리결과를
-- 영구적으로 데이터베이스에 반영시키도록 한다.
------------------------------------------------------------------트랜잭션 1이 종료됨
------------------------------------------------------------------트랜잭션 2가 실행됨

UPDATE ACCOUNTS
SET DEPOSIT = DEPOSIT - 50000
WHERE
    NO = 70; -- 트랙잭션 2의 연산이다


UPDATE ACCOUNTS
SET DEPOSIT = DEPOSIT + 50000
WHERE
    NO = 120; -- 트랙잭션 2의 연산이다


INSERT INTO HISTROIES
VALUES (79, 120, 50000, SYSDATE); -- 트랙잭션 2의 연산이다

ROLLBACK;
-- 트랙잭션 2의 INSERT 작업중 오류가 발생하였다.
-- 트랜잭션 관리자에게 트랜잭션2의 처리결과를
-- 모두 취소시키도록 한다.

```

<br>

#### 🔹 트랜잭션의 성질

+ 원자성 A : Automicity
    - 트랜잭션 내의 연산들은 모두 모두 성공하거나 전부 실패되는 성질이 있다
    - 부분적인 성공은 허용하지 않는다

    <br>

+ 일관성 C : Consistency
    - 트랜잭션이 종료되는 데이터베이스의 데이터는, 일관성을 유지한다
    - 트랜잭션이 일어난 이후의 데이터베이스는 데이터베이스의 제약이나 규직을 만족 해야한다

    <br>

+ 고립성 I : Isolation
    - 모든 트랜잭션은 다른 트랜잭션으로부터 독립적으로 처리된다

<br>

+ 지속성 D : Durability
    - 트랜잭션 성공적으로 수행 되었다면 데이터베이스에 영구적으로 반영된다. (유지 , 지속)

<br>

--------

#### 🔹 트랜잭션 관련 명령어 실행시 발생하는 일

① Commit 실행하면 일어나는 일

- 데이터베이스에 데이터를 영구적으로 반영
- 트랜잭션 실행 이전 상태를 완전히 상실 (이전 상태로 되돌아 갈 수가 없음)
- 변경된 레코드(테이블의 행)의 LOCK이 해제 되어 , 다른 사용자가 변경할 수 있게 된다

② ROLLBACK 실행하면 일어 나는 일

- 트랜잭션 실행 이전 상태로 데이터의 상태를 복구 시킨다
- 변경된 레코드 (테이블의 행) LOCK 이 해제되어 , 다른 사용자가 (트랜잭션)가 변결할 수 있게된다

